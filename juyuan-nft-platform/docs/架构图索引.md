# 📐 架构图索引文档

本文档列出了项目中所有架构图的位置和说明。

---

## 📍 架构图位置

### 1. **系统整体架构图**

**位置**: `docs/移动端应用PRD.md` - 第 3243 行

**内容**: 技术架构图，展示整个系统的技术栈和组件关系

---

### 2. **功能架构图**

**位置**: `docs/移动端应用PRD.md` - 第 463 行（4.1 功能架构图）

**内容**: 
```
钜园农业NFT移动端应用
│
├── 启动层
│   ├── 启动页（品牌展示）
│   └── 引导页（首次使用）
│
├── 认证层
│   ├── 登录
│   ├── 注册
│   └── 找回密码
│
├── 首页层
│   ├── 轮播图
│   ├── 分类导航
│   ├── 热门产品
│   └── 最新动态
│
├── 产品层
│   ├── 产品列表
│   ├── 产品详情
│   └── 产品搜索
│
├── 预售层
│   ├── 预售列表
│   ├── 预售详情
│   └── 预售购买
│
├── NFT层
│   ├── 我的NFT
│   ├── NFT详情
│   ├── NFT转让
│   └── NFT兑换
│
├── 订单层
│   ├── 订单列表
│   ├── 订单详情
│   └── 订单跟踪
│
├── 个人中心层
│   ├── 个人信息
│   ├── 收货地址
│   ├── 钱包管理
│   └── 设置
│
└── 其他功能层
    ├── 消息中心
    ├── 帮助中心
    └── 关于我们
```

---

### 3. **用户注册登录流程**

**位置**: `docs/移动端应用PRD.md` - 第 2163 行（12.1 用户注册登录流程）

**类型**: Mermaid流程图

**内容**: 
- 自动登录流程
- 多种登录方式（邮箱、手机、第三方、钱包）
- 注册流程
- Token验证机制

---

### 4. **预售购买完整流程**

**位置**: `docs/移动端应用PRD.md` - 第 2209 行（12.2 预售购买完整流程）

**类型**: Mermaid流程图

**内容**: 
- 从浏览到购买的完整流程
- 支付方式选择（微信、支付宝、加密货币）
- 订单创建和支付
- 发货和收货流程
- NFT自动铸造

---

### 5. **NFT兑换实物流程**

**位置**: `docs/移动端应用PRD.md` - 第 2274 行（12.3 NFT兑换实物流程）

**类型**: Mermaid流程图

**内容**: 
- NFT状态验证
- 兑换确认流程
- 发货订单创建
- 收货完成流程

---

### 6. **订单状态流转图**

**位置**: `docs/移动端应用PRD.md` - 第 2306 行（12.4 订单状态流转图）

**类型**: Mermaid状态图

**内容**: 
- 订单状态：待支付 → 已支付 → 已确认 → 已发货 → 运输中 → 派送中 → 已送达 → 已完成 → 已评价
- 取消和退款流程
- 超时关闭机制

---

### 7. **消息推送流程**

**位置**: `docs/移动端应用PRD.md` - 第 2339 行（12.5 消息推送流程）

**类型**: Mermaid流程图

**内容**: 
- 事件触发机制
- 多种事件类型（订单、预售、物流、NFT、营销）
- 推送设置检查
- 站内消息和推送消息

---

### 8. **生产环境架构图**

**位置**: `DEPLOYMENT_FREE.md` - 第 142 行（推荐架构）

**内容**: 
```
┌─────────────────┐
│   Frontend      │  → Vercel (免费)
│   (Next.js)     │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│   API Gateway   │  → Railway (免费)
│   (Nginx)       │
└─────────────────┘
         │
    ┌────┴────┐
    ▼         ▼
┌────────┐ ┌────────┐
│Service1│ │Service2│  → Railway (免费)
│Service3│ │Service4│
└────────┘ └────────┘
    │         │
    └────┬────┘
         ▼
┌─────────────────┐
│   Supabase      │  → Supabase (免费)
│   PostgreSQL    │
└─────────────────┘
```

---

## 🏗️ 技术架构说明

### 整体架构层次

**位置**: `README.md` - 第 24 行（技术架构）

**内容**:
1. **智能合约层** - Solidity, Hardhat, OpenZeppelin
2. **后端服务层** - Node.js, Express, TypeScript, PostgreSQL, Redis
3. **前端应用层** - Next.js, React, TypeScript, Tailwind CSS
4. **基础设施层** - Docker, Nginx, GitHub Actions

### 微服务列表

**位置**: `README.md` - 第 54 行

**服务列表**:
- User Service (3001) - 用户管理、KYC/AML
- NFT Service (3002) - NFT铸造和管理
- Presale Service (3003) - 预售管理
- Payment Service (3004) - 支付处理
- Traceability Service (3005) - 供应链溯源
- Logistics Service (3006) - 物流配送
- Compliance Service (3007) - 合规监控
- Notification Service (3008) - 通知推送
- i18n Service (3009) - 国际化
- Currency Service (3010) - 多币种

---

## 📊 数据库架构

**位置**: Supabase数据库（已创建）

**表结构**:
- `users` - 用户表
- `products` - 产品表
- `categories` - 分类表
- `presales` - 预售表
- `orders` - 订单表
- `nfts` - NFT表
- `deliveries` - 物流配送表
- `payments` - 支付记录表
- `reviews` - 评价表
- `cart_items` - 购物车表
- `kyc_applications` - KYC认证表
- `escrows` - 托管表
- `presale_whitelist` - 预售白名单
- `trace_events` - 溯源事件表

**查看方式**: 
- Supabase Dashboard: https://supabase.com/dashboard/project/wntvfodzwuyfbqisjocs
- 或使用 `mcp_supabase_list_tables` 命令

---

## 🔍 快速查找

### 按文档查找

| 文档 | 架构图数量 | 主要类型 |
|------|-----------|----------|
| `docs/移动端应用PRD.md` | 7个 | Mermaid流程图、状态图 |
| `DEPLOYMENT_FREE.md` | 1个 | ASCII架构图 |
| `README.md` | 1个 | 技术栈说明 |

### 按类型查找

| 类型 | 数量 | 位置 |
|------|------|------|
| Mermaid流程图 | 5个 | `docs/移动端应用PRD.md` |
| Mermaid状态图 | 1个 | `docs/移动端应用PRD.md` |
| ASCII架构图 | 2个 | `DEPLOYMENT_FREE.md`, `README.md` |
| 文本架构图 | 1个 | `docs/移动端应用PRD.md` |

---

## 📝 如何查看架构图

### 1. 在GitHub上查看
- 直接打开对应的 `.md` 文件
- GitHub会自动渲染Mermaid图表

### 2. 在本地查看
- 使用支持Mermaid的Markdown编辑器（如Typora、Obsidian）
- 或使用在线工具：https://mermaid.live/

### 3. 在VS Code中查看
- 安装 "Markdown Preview Mermaid Support" 扩展
- 预览Markdown文件即可看到图表

---

## 🎯 主要架构图总结

### 系统架构
- **前端**: Next.js (Web + Admin) + 微信小程序
- **后端**: 10个微服务 (Express + TypeScript)
- **数据库**: Supabase PostgreSQL
- **区块链**: Ethereum/Polygon
- **部署**: Railway (后端) + Vercel (前端)

### 数据流
1. 用户操作 → 前端应用
2. 前端 → API Gateway (Nginx)
3. API Gateway → 微服务
4. 微服务 → Supabase数据库
5. 区块链操作 → 智能合约

### 关键流程
- 用户注册登录
- 预售购买
- NFT兑换实物
- 订单状态流转
- 消息推送

---

## 📌 更新记录

- 2024-12-25: 创建架构图索引文档
- 所有架构图位置已标注

---

## 🔗 相关文档

- [README.md](../README.md) - 项目概述和技术栈
- [DEPLOYMENT_FREE.md](../DEPLOYMENT_FREE.md) - 部署架构
- [docs/移动端应用PRD.md](./移动端应用PRD.md) - 详细功能架构
- [docs/需求文档.md](./需求文档.md) - 技术需求

