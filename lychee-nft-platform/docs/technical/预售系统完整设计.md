# è”æNFTé¢„å”®ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ

> ä¸€å¥—å®Œæ•´çš„ã€å¯ç›´æ¥å®æ–½çš„é¢„å”®ç³»ç»ŸæŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [APIæ¥å£è®¾è®¡](#apiæ¥å£è®¾è®¡)
- [å‰ç«¯é¡µé¢è®¾è®¡](#å‰ç«¯é¡µé¢è®¾è®¡)
- [æ™ºèƒ½åˆçº¦è®¾è®¡](#æ™ºèƒ½åˆçº¦è®¾è®¡)
- [ä¸šåŠ¡æµç¨‹](#ä¸šåŠ¡æµç¨‹)
- [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)

---

## ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿå®šä½

ä¸€ä¸ªé›†æˆäº†åŒºå—é“¾æŠ€æœ¯çš„å†œäº§å“NFTé¢„å”®å¹³å°ï¼Œæ”¯æŒï¼š
- ğŸ¯ å¤šå“ç±»å†œäº§å“é¢„å”®
- ğŸ’° èµ„é‡‘æ‰˜ç®¡å’Œåˆ†æ®µé‡Šæ”¾
- ğŸ“¦ å…¨æµç¨‹æº¯æºè¿½è¸ª
- ğŸ”’ ç¬¬ä¸‰æ–¹æ‹…ä¿äº¤æ˜“
- ğŸŒ å…¨çƒç”¨æˆ·è®¿é—®

### æ ¸å¿ƒç‰¹æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               è”æNFTé¢„å”®ç³»ç»Ÿ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  é¢„å”®ç®¡ç† â†’ æ”¯ä»˜æ‰˜ç®¡ â†’ ç”Ÿäº§è¿½è¸ª â†’ ç‰©æµé…é€      â”‚
â”‚     â†“          â†“          â†“          â†“          â”‚
â”‚  è®¢å•ç®¡ç†   èµ„é‡‘ç®¡ç†   æº¯æºç³»ç»Ÿ   æ”¶è´§ç¡®è®¤       â”‚
â”‚     â†“          â†“          â†“          â†“          â”‚
â”‚  NFTé“¸é€    æ™ºèƒ½åˆçº¦   æ•°æ®ä¸Šé“¾   è¯„ä»·ç³»ç»Ÿ        â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|---------|
| **å‰ç«¯** | Next.js 14 + React 18 + TypeScript + Tailwind CSS |
| **åç«¯** | Node.js 18 + Express + TypeScript + Prisma ORM |
| **æ•°æ®åº“** | PostgreSQL 15 + Redis 7 |
| **åŒºå—é“¾** | Solidity + Hardhat + Ethers.js + IPFS |
| **éƒ¨ç½²** | Docker + Kubernetes + CI/CD |

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚å¾®ä¿¡å°ç¨‹åºâ”‚  â”‚ H5/Web  â”‚  â”‚ç®¡ç†åå°  â”‚  â”‚åŸºåœ°ç«¯App â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    API Gatewayå±‚                           â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚           â”‚  Nginx + Rate Limit + Auth   â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆå¾®æœåŠ¡ï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚é¢„å”®æœåŠ¡ â”‚ â”‚è®¢å•æœåŠ¡ â”‚ â”‚æ”¯ä»˜æœåŠ¡ â”‚ â”‚æº¯æºæœåŠ¡ â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚NFTæœåŠ¡  â”‚ â”‚ç”¨æˆ·æœåŠ¡ â”‚ â”‚ç‰©æµæœåŠ¡ â”‚ â”‚æ¶ˆæ¯æœåŠ¡ â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®å­˜å‚¨å±‚              â”‚      â”‚    åŒºå—é“¾å±‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚      â”‚  â”‚ Smart Contractsâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   IPFS   â”‚ â”‚   OSS    â”‚ â”‚      â”‚  â”‚   Ethereum    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â”‚   Polygon     â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¾®æœåŠ¡æ¶æ„

æ¯ä¸ªæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œé€šè¿‡API Gatewayç»Ÿä¸€å¯¹å¤–ï¼š

```typescript
// æœåŠ¡åˆ—è¡¨
const services = {
  presale: {
    port: 4001,
    domain: 'presale-service',
    description: 'é¢„å”®ç®¡ç†æœåŠ¡'
  },
  order: {
    port: 4002,
    domain: 'order-service',
    description: 'è®¢å•ç®¡ç†æœåŠ¡'
  },
  payment: {
    port: 4003,
    domain: 'payment-service',
    description: 'æ”¯ä»˜æ‰˜ç®¡æœåŠ¡'
  },
  nft: {
    port: 4004,
    domain: 'nft-service',
    description: 'NFTé“¸é€ æœåŠ¡'
  },
  trace: {
    port: 4005,
    domain: 'trace-service',
    description: 'æº¯æºè¿½è¸ªæœåŠ¡'
  },
  logistics: {
    port: 4006,
    domain: 'logistics-service',
    description: 'ç‰©æµé…é€æœåŠ¡'
  },
  user: {
    port: 4007,
    domain: 'user-service',
    description: 'ç”¨æˆ·ç®¡ç†æœåŠ¡'
  }
};
```

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. é¢„å”®ç®¡ç†æ¨¡å—

#### åŠŸèƒ½æ¸…å•

```
é¢„å”®ç®¡ç†
â”œâ”€â”€ é¢„å”®æ´»åŠ¨åˆ›å»º
â”‚   â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯è®¾ç½®
â”‚   â”œâ”€â”€ ä»·æ ¼ç­–ç•¥é…ç½®
â”‚   â”œâ”€â”€ åº“å­˜æ•°é‡ç®¡ç†
â”‚   â””â”€â”€ æ—¶é—´èŠ‚ç‚¹è®¾ç½®
â”œâ”€â”€ é¢„å”®æ´»åŠ¨ç®¡ç†
â”‚   â”œâ”€â”€ æ´»åŠ¨çŠ¶æ€æ§åˆ¶
â”‚   â”œâ”€â”€ åº“å­˜å®æ—¶æ›´æ–°
â”‚   â”œâ”€â”€ ä»·æ ¼åŠ¨æ€è°ƒæ•´
â”‚   â””â”€â”€ æ´»åŠ¨æ•°æ®ç»Ÿè®¡
â”œâ”€â”€ NFTé…ç½®
â”‚   â”œâ”€â”€ NFTå…ƒæ•°æ®è®¾ç½®
â”‚   â”œâ”€â”€ æƒç›Šè§„åˆ™é…ç½®
â”‚   â”œâ”€â”€ ç¨€ç¼ºæ€§ç®¡ç†
â”‚   â””â”€â”€ æ‰¹é‡é“¸é€ è®¾ç½®
â””â”€â”€ é¢„å”®å®¡æ ¸
    â”œâ”€â”€ èµ„è´¨å®¡æ ¸
    â”œâ”€â”€ å†…å®¹å®¡æ ¸
    â”œâ”€â”€ ä»·æ ¼å®¡æ ¸
    â””â”€â”€ åˆè§„å®¡æ ¸
```

#### é¢„å”®æ´»åŠ¨ç”Ÿå‘½å‘¨æœŸ

```
[åˆ›å»º] â†’ [å®¡æ ¸] â†’ [é¢„çƒ­] â†’ [è¿›è¡Œä¸­] â†’ [å”®ç½„/ç»“æŸ] â†’ [å½’æ¡£]
   â†“        â†“        â†“         â†“            â†“           â†“
 è‰ç¨¿     å¾…å®¡æ ¸   å³å°†å¼€å§‹   é”€å”®ä¸­      å·²å®Œæˆ      å†å²è®°å½•
   â†“        â†“        â†“         â†“            â†“           â†“
 å¯ç¼–è¾‘   å¯æ’¤å›   å¯å–æ¶ˆ    å¯æš‚åœ      ç”ŸæˆæŠ¥å‘Š    ä»…æŸ¥çœ‹
```

#### æ•°æ®æ¨¡å‹

```typescript
// é¢„å”®æ´»åŠ¨æ¨¡å‹
interface PresaleActivity {
  // åŸºæœ¬ä¿¡æ¯
  id: string;
  presale_number: string;  // é¢„å”®ç¼–å· PS20240001
  title: string;           // æ´»åŠ¨æ ‡é¢˜
  subtitle: string;        // å‰¯æ ‡é¢˜
  description: string;     // è¯¦ç»†æè¿°
  cover_image: string;     // å°é¢å›¾ç‰‡
  banner_images: string[]; // è½®æ’­å›¾ç‰‡
  
  // äº§å“ä¿¡æ¯
  product: {
    category: string;      // äº§å“ç±»åˆ«ï¼šlychee/longan/mango
    variety: string;       // å“ç§ï¼šæé¾™è›‹/æ¡‚å‘³/ç³¯ç±³ç³
    grade: string;         // ç­‰çº§ï¼šç‰¹çº§/ä¸€çº§/äºŒçº§
    weight: number;        // é‡é‡ï¼ˆæ–¤ï¼‰
    unit: string;          // å•ä½
    specs: object;         // è§„æ ¼å‚æ•°
  };
  
  // ä»·æ ¼ç­–ç•¥
  pricing: {
    original_price: number;    // åŸä»·
    presale_price: number;     // é¢„å”®ä»·
    discount_rate: number;     // æŠ˜æ‰£ç‡
    deposit: number;           // å®šé‡‘ï¼ˆ0è¡¨ç¤ºå…¨æ¬¾ï¼‰
    final_payment: number;     // å°¾æ¬¾
    group_discount: object;    // å›¢è´­ä¼˜æƒ 
    early_bird_discount: object; // æ—©é¸Ÿä¼˜æƒ 
  };
  
  // åº“å­˜ç®¡ç†
  inventory: {
    total: number;             // æ€»åº“å­˜
    available: number;         // å¯å”®åº“å­˜
    reserved: number;          // é¢„ç•™åº“å­˜
    sold: number;              // å·²å”®æ•°é‡
    min_purchase: number;      // æœ€å°è´­ä¹°é‡
    max_purchase: number;      // æœ€å¤§è´­ä¹°é‡
    limit_per_user: number;    // æ¯äººé™è´­
  };
  
  // æ—¶é—´èŠ‚ç‚¹
  timeline: {
    presale_start: Date;       // é¢„å”®å¼€å§‹
    presale_end: Date;         // é¢„å”®ç»“æŸ
    harvest_start: Date;       // é‡‡æ‘˜å¼€å§‹
    harvest_end: Date;         // é‡‡æ‘˜ç»“æŸ
    delivery_deadline: Date;   // å‘è´§æˆªæ­¢
    deposit_deadline: Date;    // å°¾æ¬¾æˆªæ­¢ï¼ˆå¦‚æœ‰å®šé‡‘ï¼‰
  };
  
  // NFTé…ç½®
  nft_config: {
    collection_name: string;   // NFTç³»åˆ—åç§°
    contract_address: string;  // åˆçº¦åœ°å€
    token_id_start: number;    // èµ·å§‹Token ID
    metadata_uri: string;      // å…ƒæ•°æ®URI
    rights: string[];          // æŒæœ‰æƒç›Š
    transferable: boolean;     // æ˜¯å¦å¯è½¬è®©
    royalty_rate: number;      // ç‰ˆç¨æ¯”ä¾‹
  };
  
  // é…é€ä¿¡æ¯
  shipping: {
    regions: string[];         // é…é€åŒºåŸŸ
    free_shipping: boolean;    // æ˜¯å¦åŒ…é‚®
    shipping_fee: number;      // è¿è´¹
    cold_chain: boolean;       // æ˜¯å¦å†·é“¾
    insurance: boolean;        // æ˜¯å¦ä¿é™©
    estimated_days: number;    // é¢„è®¡å¤©æ•°
  };
  
  // æ´»åŠ¨æ ‡ç­¾
  tags: string[];              // æ ‡ç­¾ï¼šçƒ­é—¨/æ–°å“/é™é‡
  
  // çŠ¶æ€ä¿¡æ¯
  status: PresaleStatus;       // æ´»åŠ¨çŠ¶æ€
  audit_status: AuditStatus;   // å®¡æ ¸çŠ¶æ€
  
  // å–å®¶ä¿¡æ¯
  orchard: {
    id: string;
    name: string;
    location: string;
    certification: string[];
    rating: number;
  };
  
  // ç»Ÿè®¡æ•°æ®
  stats: {
    views: number;             // æµè§ˆé‡
    likes: number;             // ç‚¹èµæ•°
    shares: number;            // åˆ†äº«æ•°
    conversion_rate: number;   // è½¬åŒ–ç‡
  };
  
  // æ—¶é—´æˆ³
  created_at: Date;
  updated_at: Date;
  published_at: Date;
}

// é¢„å”®çŠ¶æ€æšä¸¾
enum PresaleStatus {
  DRAFT = 'draft',           // è‰ç¨¿
  PENDING = 'pending',       // å¾…å®¡æ ¸
  APPROVED = 'approved',     // å·²å®¡æ ¸
  SCHEDULED = 'scheduled',   // å·²æ’æœŸ
  ACTIVE = 'active',         // è¿›è¡Œä¸­
  PAUSED = 'paused',         // å·²æš‚åœ
  SOLD_OUT = 'sold_out',     // å·²å”®ç½„
  ENDED = 'ended',           // å·²ç»“æŸ
  CANCELLED = 'cancelled',   // å·²å–æ¶ˆ
  ARCHIVED = 'archived'      // å·²å½’æ¡£
}
```

### 2. è®¢å•ç®¡ç†æ¨¡å—

#### è®¢å•çŠ¶æ€æµè½¬

```
åˆ›å»ºè®¢å• â†’ å¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ â†’ ç”Ÿäº§ä¸­ â†’ å¾…å‘è´§ â†’ å·²å‘è´§ â†’ 
å¾…æ”¶è´§ â†’ å·²å®Œæˆ â†’ å·²è¯„ä»·

         â†“
      å¯å–æ¶ˆ/é€€æ¬¾
         â†“
      å·²å–æ¶ˆ/å·²é€€æ¬¾
```

#### è®¢å•æ•°æ®æ¨¡å‹

```typescript
interface Order {
  // åŸºæœ¬ä¿¡æ¯
  order_id: string;          // è®¢å•ID
  order_number: string;      // è®¢å•å· ORD20240315001
  
  // å…³è”ä¿¡æ¯
  user_id: string;           // ä¹°å®¶ID
  presale_id: string;        // é¢„å”®æ´»åŠ¨ID
  nft_token_id: string;      // NFT Token ID
  
  // å•†å“ä¿¡æ¯
  product_info: {
    name: string;
    variety: string;
    grade: string;
    weight: number;
    quantity: number;
    unit_price: number;
  };
  
  // é‡‘é¢ä¿¡æ¯
  amount: {
    product_amount: number;   // å•†å“é‡‘é¢
    shipping_fee: number;     // è¿è´¹
    discount_amount: number;  // ä¼˜æƒ é‡‘é¢
    coupon_amount: number;    // ä¼˜æƒ åˆ¸é‡‘é¢
    total_amount: number;     // è®¢å•æ€»é¢
    paid_amount: number;      // å®ä»˜é‡‘é¢
    refund_amount: number;    // é€€æ¬¾é‡‘é¢
  };
  
  // èµ„é‡‘åˆ†é…ï¼ˆæ‰˜ç®¡ï¼‰
  escrow: {
    platform_fee: number;     // å¹³å°æœåŠ¡è´¹ 5%
    logistics_fee: number;    // ç‰©æµè´¹ 10%
    initial_payment: number;  // é¦–æ¬¾ 30%
    final_payment: number;    // å°¾æ¬¾ 55%
    released_amount: number;  // å·²é‡Šæ”¾é‡‘é¢
    locked_amount: number;    // é”å®šé‡‘é¢
  };
  
  // æ”¶è´§ä¿¡æ¯
  shipping_address: {
    recipient: string;        // æ”¶ä»¶äºº
    phone: string;            // ç”µè¯
    province: string;         // çœä»½
    city: string;             // åŸå¸‚
    district: string;         // åŒºå¿
    address: string;          // è¯¦ç»†åœ°å€
    postal_code: string;      // é‚®ç¼–
    note: string;             // å¤‡æ³¨
  };
  
  // ç‰©æµä¿¡æ¯
  logistics: {
    company: string;          // ç‰©æµå…¬å¸
    tracking_number: string;  // è¿å•å·
    shipped_at: Date;         // å‘è´§æ—¶é—´
    delivered_at: Date;       // ç­¾æ”¶æ—¶é—´
    estimated_delivery: Date; // é¢„è®¡é€è¾¾
    status: string;           // ç‰©æµçŠ¶æ€
    trace: LogisticsTrace[];  // ç‰©æµè½¨è¿¹
  };
  
  // æ”¯ä»˜ä¿¡æ¯
  payment: {
    method: string;           // æ”¯ä»˜æ–¹å¼
    channel: string;          // æ”¯ä»˜æ¸ é“
    transaction_id: string;   // äº¤æ˜“æµæ°´å·
    paid_at: Date;            // æ”¯ä»˜æ—¶é—´
    blockchain_tx: string;    // åŒºå—é“¾äº¤æ˜“å“ˆå¸Œ
  };
  
  // çŠ¶æ€ä¿¡æ¯
  status: OrderStatus;        // è®¢å•çŠ¶æ€
  payment_status: string;     // æ”¯ä»˜çŠ¶æ€
  shipment_status: string;    // å‘è´§çŠ¶æ€
  refund_status: string;      // é€€æ¬¾çŠ¶æ€
  
  // è¯„ä»·ä¿¡æ¯
  review: {
    rating: number;           // è¯„åˆ† 1-5
    comment: string;          // è¯„ä»·å†…å®¹
    photos: string[];         // æ™’å•å›¾ç‰‡
    tags: string[];           // æ ‡ç­¾
    reviewed_at: Date;        // è¯„ä»·æ—¶é—´
  };
  
  // å”®åä¿¡æ¯
  after_sales: {
    type: string;             // å”®åç±»å‹
    reason: string;           // å”®ååŸå› 
    status: string;           // å”®åçŠ¶æ€
    apply_at: Date;           // ç”³è¯·æ—¶é—´
    resolve_at: Date;         // è§£å†³æ—¶é—´
  };
  
  // æ—¶é—´æˆ³
  created_at: Date;
  updated_at: Date;
  paid_at: Date;
  confirmed_at: Date;
  completed_at: Date;
}
```

### 3. æ”¯ä»˜æ‰˜ç®¡æ¨¡å—

#### æ”¯ä»˜æµç¨‹

```
é€‰æ‹©æ”¯ä»˜æ–¹å¼ â†’ åˆ›å»ºæ”¯ä»˜è®¢å• â†’ è°ƒç”¨æ”¯ä»˜æ¥å£ â†’ 
æ”¯ä»˜æˆåŠŸå›è°ƒ â†’ èµ„é‡‘æ‰˜ç®¡ â†’ åˆ†æ®µé‡Šæ”¾

æ”¯æŒçš„æ”¯ä»˜æ–¹å¼ï¼š
â”œâ”€â”€ å¾®ä¿¡æ”¯ä»˜
â”œâ”€â”€ æ”¯ä»˜å®
â”œâ”€â”€ é“¶è”æ”¯ä»˜
â”œâ”€â”€ ETHæ”¯ä»˜
â”œâ”€â”€ USDTæ”¯ä»˜
â””â”€â”€ å…¶ä»–åŠ å¯†è´§å¸
```

#### èµ„é‡‘æ‰˜ç®¡åˆçº¦

```solidity
// ç®€åŒ–ç‰ˆæ‰˜ç®¡åˆçº¦
contract EscrowManager {
    struct Escrow {
        address buyer;
        address seller;
        uint256 totalAmount;
        uint256 platformFee;     // 5%
        uint256 logisticsFee;    // 10%
        uint256 initialPayment;  // 30%
        uint256 finalPayment;    // 55%
        uint256 releasedAmount;
        EscrowStatus status;
        uint256 createdAt;
        uint256 deliveryDeadline;
    }
    
    mapping(bytes32 => Escrow) public escrows;
    
    // åˆ›å»ºæ‰˜ç®¡
    function createEscrow(
        bytes32 orderId,
        address seller,
        uint256 deliveryDeadline
    ) external payable {
        require(msg.value > 0, "Invalid amount");
        
        uint256 amount = msg.value;
        Escrow storage escrow = escrows[orderId];
        
        escrow.buyer = msg.sender;
        escrow.seller = seller;
        escrow.totalAmount = amount;
        escrow.platformFee = amount * 5 / 100;
        escrow.logisticsFee = amount * 10 / 100;
        escrow.initialPayment = amount * 30 / 100;
        escrow.finalPayment = amount * 55 / 100;
        escrow.status = EscrowStatus.Locked;
        escrow.createdAt = block.timestamp;
        escrow.deliveryDeadline = deliveryDeadline;
        
        // ç«‹å³æ‰£é™¤å¹³å°è´¹
        payable(platform).transfer(escrow.platformFee);
        
        emit EscrowCreated(orderId, msg.sender, seller, amount);
    }
    
    // å‘è´§é‡Šæ”¾ï¼ˆé¦–æ¬¾+ç‰©æµè´¹ï¼‰
    function releaseOnShipment(bytes32 orderId) external onlySeller {
        Escrow storage escrow = escrows[orderId];
        require(escrow.status == EscrowStatus.Locked);
        
        uint256 releaseAmount = escrow.initialPayment + escrow.logisticsFee;
        payable(escrow.seller).transfer(releaseAmount);
        escrow.releasedAmount += releaseAmount;
        escrow.status = EscrowStatus.Shipped;
        
        emit FundsReleased(orderId, escrow.seller, releaseAmount);
    }
    
    // ç¡®è®¤æ”¶è´§é‡Šæ”¾ï¼ˆå°¾æ¬¾ï¼‰
    function releaseOnDelivery(bytes32 orderId) external onlyBuyer {
        Escrow storage escrow = escrows[orderId];
        require(escrow.status == EscrowStatus.Shipped);
        
        payable(escrow.seller).transfer(escrow.finalPayment);
        escrow.releasedAmount += escrow.finalPayment;
        escrow.status = EscrowStatus.Completed;
        
        emit DeliveryConfirmed(orderId, escrow.finalPayment);
    }
}
```

---

## æ•°æ®åº“è®¾è®¡

### ERå›¾

```
Users (ç”¨æˆ·è¡¨)
â”œâ”€â”€ user_id (PK)
â”œâ”€â”€ wallet_address
â”œâ”€â”€ username
â”œâ”€â”€ role
â””â”€â”€ created_at

Presales (é¢„å”®æ´»åŠ¨è¡¨)
â”œâ”€â”€ presale_id (PK)
â”œâ”€â”€ orchard_id (FK)
â”œâ”€â”€ product_info (JSONB)
â”œâ”€â”€ pricing (JSONB)
â”œâ”€â”€ inventory (JSONB)
â”œâ”€â”€ status
â””â”€â”€ created_at

Orders (è®¢å•è¡¨)
â”œâ”€â”€ order_id (PK)
â”œâ”€â”€ user_id (FK)
â”œâ”€â”€ presale_id (FK)
â”œâ”€â”€ nft_token_id
â”œâ”€â”€ amount (JSONB)
â”œâ”€â”€ status
â””â”€â”€ created_at

NFTs (NFTè¡¨)
â”œâ”€â”€ token_id (PK)
â”œâ”€â”€ contract_address
â”œâ”€â”€ owner_address
â”œâ”€â”€ metadata_uri
â”œâ”€â”€ status
â””â”€â”€ minted_at

Traces (æº¯æºè®°å½•è¡¨)
â”œâ”€â”€ trace_id (PK)
â”œâ”€â”€ nft_token_id (FK)
â”œâ”€â”€ stage
â”œâ”€â”€ data (JSONB)
â”œâ”€â”€ blockchain_hash
â””â”€â”€ created_at

Logistics (ç‰©æµè¡¨)
â”œâ”€â”€ logistics_id (PK)
â”œâ”€â”€ order_id (FK)
â”œâ”€â”€ tracking_number
â”œâ”€â”€ status
â”œâ”€â”€ trace (JSONB)
â””â”€â”€ updated_at
```

### æ ¸å¿ƒè¡¨SQL

```sql
-- é¢„å”®æ´»åŠ¨è¡¨
CREATE TABLE presales (
    presale_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    presale_number VARCHAR(20) UNIQUE NOT NULL,
    title VARCHAR(200) NOT NULL,
    subtitle VARCHAR(500),
    description TEXT,
    cover_image VARCHAR(500),
    banner_images TEXT[],
    
    -- äº§å“ä¿¡æ¯ï¼ˆJSONBï¼‰
    product_info JSONB NOT NULL,
    
    -- ä»·æ ¼ç­–ç•¥ï¼ˆJSONBï¼‰
    pricing JSONB NOT NULL,
    
    -- åº“å­˜ç®¡ç†ï¼ˆJSONBï¼‰
    inventory JSONB NOT NULL,
    
    -- æ—¶é—´èŠ‚ç‚¹ï¼ˆJSONBï¼‰
    timeline JSONB NOT NULL,
    
    -- NFTé…ç½®ï¼ˆJSONBï¼‰
    nft_config JSONB,
    
    -- é…é€ä¿¡æ¯ï¼ˆJSONBï¼‰
    shipping JSONB,
    
    -- æœå›­ä¿¡æ¯
    orchard_id UUID NOT NULL REFERENCES orchards(orchard_id),
    
    -- çŠ¶æ€
    status VARCHAR(20) NOT NULL DEFAULT 'draft',
    audit_status VARCHAR(20) NOT NULL DEFAULT 'pending',
    
    -- æ ‡ç­¾
    tags TEXT[],
    
    -- ç»Ÿè®¡æ•°æ®ï¼ˆJSONBï¼‰
    stats JSONB DEFAULT '{}',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    published_at TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_status (status),
    INDEX idx_orchard (orchard_id),
    INDEX idx_created (created_at DESC),
    INDEX idx_product (((product_info->>'category'))),
    FULLTEXT INDEX idx_search (title, description)
);

-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    order_number VARCHAR(30) UNIQUE NOT NULL,
    
    -- å…³è”
    user_id UUID NOT NULL REFERENCES users(user_id),
    presale_id UUID NOT NULL REFERENCES presales(presale_id),
    nft_token_id BIGINT,
    
    -- å•†å“ä¿¡æ¯ï¼ˆJSONBï¼‰
    product_info JSONB NOT NULL,
    
    -- é‡‘é¢ä¿¡æ¯ï¼ˆJSONBï¼‰
    amount JSONB NOT NULL,
    
    -- æ‰˜ç®¡ä¿¡æ¯ï¼ˆJSONBï¼‰
    escrow JSONB,
    
    -- æ”¶è´§åœ°å€ï¼ˆJSONBï¼‰
    shipping_address JSONB NOT NULL,
    
    -- ç‰©æµä¿¡æ¯ï¼ˆJSONBï¼‰
    logistics JSONB,
    
    -- æ”¯ä»˜ä¿¡æ¯ï¼ˆJSONBï¼‰
    payment JSONB,
    
    -- çŠ¶æ€
    status VARCHAR(20) NOT NULL DEFAULT 'pending_payment',
    payment_status VARCHAR(20) DEFAULT 'unpaid',
    shipment_status VARCHAR(20) DEFAULT 'not_shipped',
    refund_status VARCHAR(20) DEFAULT 'none',
    
    -- è¯„ä»·ï¼ˆJSONBï¼‰
    review JSONB,
    
    -- å”®åï¼ˆJSONBï¼‰
    after_sales JSONB,
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    paid_at TIMESTAMP,
    shipped_at TIMESTAMP,
    delivered_at TIMESTAMP,
    confirmed_at TIMESTAMP,
    completed_at TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_user (user_id),
    INDEX idx_presale (presale_id),
    INDEX idx_status (status),
    INDEX idx_created (created_at DESC)
);

-- NFTè¡¨
CREATE TABLE nfts (
    token_id BIGINT PRIMARY KEY,
    contract_address VARCHAR(42) NOT NULL,
    collection_name VARCHAR(100),
    
    -- æ‰€æœ‰è€…
    owner_address VARCHAR(42) NOT NULL,
    
    -- å…ƒæ•°æ®
    metadata_uri VARCHAR(500),
    metadata JSONB,
    
    -- å…³è”è®¢å•
    order_id UUID REFERENCES orders(order_id),
    presale_id UUID REFERENCES presales(presale_id),
    
    -- æƒç›Šä¿¡æ¯ï¼ˆJSONBï¼‰
    rights JSONB,
    
    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'locked',
    transferable BOOLEAN DEFAULT FALSE,
    
    -- äº¤æ˜“å†å²ï¼ˆJSONBæ•°ç»„ï¼‰
    transaction_history JSONB DEFAULT '[]',
    
    -- æ—¶é—´æˆ³
    minted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    transferred_at TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_owner (owner_address),
    INDEX idx_contract (contract_address),
    INDEX idx_order (order_id)
);

-- æº¯æºè®°å½•è¡¨
CREATE TABLE trace_records (
    trace_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    
    -- å…³è”
    nft_token_id BIGINT REFERENCES nfts(token_id),
    presale_id UUID REFERENCES presales(presale_id),
    order_id UUID REFERENCES orders(order_id),
    
    -- æº¯æºé˜¶æ®µ
    stage VARCHAR(50) NOT NULL,
    stage_index INT NOT NULL,
    
    -- æº¯æºæ•°æ®ï¼ˆJSONBï¼‰
    data JSONB NOT NULL,
    
    -- åª’ä½“æ–‡ä»¶
    photos TEXT[],
    videos TEXT[],
    
    -- ç¯å¢ƒæ•°æ®ï¼ˆJSONBï¼‰
    environment_data JSONB,
    
    -- åŒºå—é“¾ä¿¡æ¯
    blockchain_hash VARCHAR(66),
    blockchain_timestamp BIGINT,
    
    -- å®¡æ ¸çŠ¶æ€
    verified BOOLEAN DEFAULT FALSE,
    verifier_id UUID REFERENCES users(user_id),
    verified_at TIMESTAMP,
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    uploaded_at TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_nft (nft_token_id),
    INDEX idx_stage (stage),
    INDEX idx_created (created_at DESC)
);
```

---

## APIæ¥å£è®¾è®¡

### RESTful APIè§„èŒƒ

```
åŸºç¡€URL: https://api.lychee-nft.com/v1

è®¤è¯æ–¹å¼: 
- Bearer Token (JWT)
- API Key

å“åº”æ ¼å¼:
{
  "success": boolean,
  "data": any,
  "message": string,
  "code": number,
  "timestamp": number
}
```

### æ ¸å¿ƒæ¥å£åˆ—è¡¨

#### 1. é¢„å”®ç®¡ç†API

```typescript
// è·å–é¢„å”®åˆ—è¡¨
GET /presales
Query: {
  page?: number;
  limit?: number;
  category?: string;    // äº§å“ç±»åˆ«
  status?: string;      // çŠ¶æ€ç­›é€‰
  sort?: string;        // æ’åºæ–¹å¼
  keyword?: string;     // æœç´¢å…³é”®è¯
}
Response: {
  success: true,
  data: {
    list: Presale[],
    total: number,
    page: number,
    limit: number
  }
}

// è·å–é¢„å”®è¯¦æƒ…
GET /presales/:presaleId
Response: {
  success: true,
  data: PresaleDetail
}

// åˆ›å»ºé¢„å”®æ´»åŠ¨ï¼ˆæœå›­ç«¯ï¼‰
POST /presales
Body: CreatePresaleDTO
Response: {
  success: true,
  data: {
    presale_id: string,
    presale_number: string
  }
}

// æ›´æ–°é¢„å”®æ´»åŠ¨
PATCH /presales/:presaleId
Body: UpdatePresaleDTO

// å®¡æ ¸é¢„å”®æ´»åŠ¨ï¼ˆç®¡ç†ç«¯ï¼‰
POST /presales/:presaleId/review
Body: {
  approved: boolean,
  reason?: string
}

// å‘å¸ƒé¢„å”®æ´»åŠ¨
POST /presales/:presaleId/publish

// æš‚åœé¢„å”®æ´»åŠ¨
POST /presales/:presaleId/pause

// è·å–é¢„å”®ç»Ÿè®¡
GET /presales/:presaleId/stats
```

#### 2. è®¢å•ç®¡ç†API

```typescript
// åˆ›å»ºè®¢å•
POST /orders/create
Body: {
  presale_id: string,
  quantity: number,
  shipping_address: Address,
  coupon_code?: string
}
Response: {
  success: true,
  data: {
    order_id: string,
    order_number: string,
    amount: OrderAmount,
    payment_info: PaymentInfo
  }
}

// æ”¯ä»˜è®¢å•
POST /orders/:orderId/pay
Body: {
  payment_method: string,
  payment_channel: string
}
Response: {
  success: true,
  data: {
    payment_url?: string,
    qr_code?: string,
    payment_params: any
  }
}

// æ”¯ä»˜å›è°ƒ
POST /orders/payment/callback
Body: PaymentCallbackData

// ç¡®è®¤å‘è´§ï¼ˆæœå›­ç«¯ï¼‰
POST /orders/:orderId/ship
Body: {
  tracking_number: string,
  logistics_company: string,
  package_photos: string[]
}

// ç¡®è®¤æ”¶è´§ï¼ˆä¹°å®¶ç«¯ï¼‰
POST /orders/:orderId/confirm

// ç”³è¯·å”®å
POST /orders/:orderId/after-sales
Body: {
  type: string,
  reason: string,
  evidence: string[]
}

// è·å–è®¢å•åˆ—è¡¨
GET /orders
Query: {
  user_id?: string,
  status?: string,
  page?: number,
  limit?: number
}

// è·å–è®¢å•è¯¦æƒ…
GET /orders/:orderId

// å–æ¶ˆè®¢å•
POST /orders/:orderId/cancel

// è®¢å•è¯„ä»·
POST /orders/:orderId/review
Body: {
  rating: number,
  comment: string,
  photos?: string[],
  tags?: string[]
}
```

#### 3. NFTç®¡ç†API

```typescript
// é“¸é€ NFT
POST /nfts/mint
Body: {
  presale_id: string,
  order_id: string,
  owner_address: string,
  metadata: NFTMetadata
}

// è·å–NFTåˆ—è¡¨
GET /nfts
Query: {
  owner_address?: string,
  collection?: string,
  page?: number,
  limit?: number
}

// è·å–NFTè¯¦æƒ…
GET /nfts/:tokenId

// è½¬ç§»NFT
POST /nfts/:tokenId/transfer
Body: {
  to_address: string,
  signature: string
}

// è·å–NFTå†å²
GET /nfts/:tokenId/history
```

#### 4. æº¯æºç®¡ç†API

```typescript
// ä¸Šä¼ æº¯æºæ•°æ®ï¼ˆæœå›­ç«¯ï¼‰
POST /trace/upload
Body: {
  nft_token_id: string,
  stage: string,
  data: TraceData,
  photos?: string[],
  videos?: string[]
}

// è·å–æº¯æºè®°å½•
GET /trace/:tokenId
Response: {
  success: true,
  data: {
    timeline: TraceRecord[],
    current_stage: string,
    completion_rate: number
  }
}

// éªŒè¯æº¯æºæ•°æ®
GET /trace/verify/:traceId
Response: {
  success: true,
  data: {
    verified: boolean,
    blockchain_hash: string,
    blockchain_timestamp: number
  }
}
```

---

## å‰ç«¯é¡µé¢è®¾è®¡

### é¡µé¢ç»“æ„

```
å¾®ä¿¡å°ç¨‹åºï¼ˆä¹°å®¶ç«¯ï¼‰
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index/              # é¦–é¡µ
â”‚   â”œâ”€â”€ presale/
â”‚   â”‚   â”œâ”€â”€ list/          # é¢„å”®åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ detail/        # é¢„å”®è¯¦æƒ…
â”‚   â”œâ”€â”€ order/
â”‚   â”‚   â”œâ”€â”€ confirm/       # ç¡®è®¤è®¢å•
â”‚   â”‚   â”œâ”€â”€ pay/           # æ”¯ä»˜é¡µé¢
â”‚   â”‚   â”œâ”€â”€ list/          # è®¢å•åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ detail/        # è®¢å•è¯¦æƒ…
â”‚   â”œâ”€â”€ nft/
â”‚   â”‚   â”œâ”€â”€ list/          # æˆ‘çš„NFT
â”‚   â”‚   â””â”€â”€ detail/        # NFTè¯¦æƒ…
â”‚   â”œâ”€â”€ trace/             # æº¯æºè¿½è¸ª
â”‚   â””â”€â”€ user/              # ä¸ªäººä¸­å¿ƒ

ç®¡ç†åå°ï¼ˆä¸­ä»‹ç«¯ï¼‰
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ dashboard/         # æ•°æ®çœ‹æ¿
â”‚   â”œâ”€â”€ presales/          # é¢„å”®ç®¡ç†
â”‚   â”œâ”€â”€ orders/            # è®¢å•ç®¡ç†
â”‚   â”œâ”€â”€ users/             # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ nfts/              # NFTç®¡ç†
â”‚   â”œâ”€â”€ orchards/          # æœå›­ç®¡ç†
â”‚   â”œâ”€â”€ finance/           # è´¢åŠ¡ç®¡ç†
â”‚   â””â”€â”€ settings/          # ç³»ç»Ÿè®¾ç½®

æœå›­ç«¯ï¼ˆH5/APPï¼‰
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ home/              # å·¥ä½œå°
â”‚   â”œâ”€â”€ presales/          # é¢„å”®ç®¡ç†
â”‚   â”œâ”€â”€ orders/            # è®¢å•ç®¡ç†
â”‚   â”œâ”€â”€ trace/             # æº¯æºä¸Šä¼ 
â”‚   â”œâ”€â”€ logistics/         # ç‰©æµç®¡ç†
â”‚   â””â”€â”€ finance/           # æ”¶ç›Šç®¡ç†
```

### æ ¸å¿ƒé¡µé¢åŸå‹

#### é¢„å”®è¯¦æƒ…é¡µ

```jsx
// é¢„å”®è¯¦æƒ…é¡µç»„ä»¶
export default function PresaleDetailPage() {
  return (
    <div className="presale-detail">
      {/* è½®æ’­å›¾ */}
      <Swiper images={bannerImages} />
      
      {/* åŸºæœ¬ä¿¡æ¯ */}
      <div className="info-section">
        <h1>{presale.title}</h1>
        <div className="price">
          <span className="presale-price">Â¥{presalePrice}</span>
          <span className="original-price">Â¥{originalPrice}</span>
          <span className="discount">{discount}æŠ˜</span>
        </div>
        <div className="sales">
          å·²å”®{soldCount}/{totalCount}
        </div>
      </div>
      
      {/* å€’è®¡æ—¶ */}
      <Countdown endTime={presaleEnd} />
      
      {/* äº§å“è¯¦æƒ… */}
      <div className="product-detail">
        <Tabs>
          <Tab label="äº§å“ä»‹ç»">
            <RichContent html={description} />
          </Tab>
          <Tab label="è§„æ ¼å‚æ•°">
            <SpecTable specs={specs} />
          </Tab>
          <Tab label="æœå›­ä»‹ç»">
            <OrchardInfo orchard={orchard} />
          </Tab>
          <Tab label="ç”¨æˆ·è¯„ä»·">
            <ReviewList reviews={reviews} />
          </Tab>
        </Tabs>
      </div>
      
      {/* åº•éƒ¨è´­ä¹°æ  */}
      <div className="bottom-bar">
        <Button onClick={handleAddToCart}>
          åŠ å…¥è´­ç‰©è½¦
        </Button>
        <Button type="primary" onClick={handleBuyNow}>
          ç«‹å³è´­ä¹°
        </Button>
      </div>
    </div>
  );
}
```

#### ç¡®è®¤è®¢å•é¡µ

```jsx
export default function OrderConfirmPage() {
  return (
    <div className="order-confirm">
      {/* æ”¶è´§åœ°å€ */}
      <AddressSelector
        value={selectedAddress}
        onChange={setSelectedAddress}
      />
      
      {/* å•†å“ä¿¡æ¯ */}
      <div className="product-info">
        <img src={coverImage} />
        <div className="detail">
          <h3>{productName}</h3>
          <p>{specs}</p>
          <div className="price-quantity">
            <span>Â¥{price}</span>
            <span>Ã—{quantity}</span>
          </div>
        </div>
      </div>
      
      {/* é…é€æ–¹å¼ */}
      <div className="delivery-method">
        <Radio.Group value={deliveryMethod}>
          <Radio value="standard">
            æ ‡å‡†é…é€ï¼ˆé¢„è®¡{estimatedDays}å¤©é€è¾¾ï¼‰
          </Radio>
          <Radio value="express">
            åŠ æ€¥é…é€ï¼ˆé¢å¤–Â¥{expressFee}ï¼‰
          </Radio>
        </Radio.Group>
      </div>
      
      {/* ä¼˜æƒ åˆ¸ */}
      <CouponSelector
        available={availableCoupons}
        selected={selectedCoupon}
        onChange={setSelectedCoupon}
      />
      
      {/* é‡‘é¢æ˜ç»† */}
      <div className="amount-detail">
        <div className="item">
          <span>å•†å“é‡‘é¢</span>
          <span>Â¥{productAmount}</span>
        </div>
        <div className="item">
          <span>è¿è´¹</span>
          <span>{shippingFee === 0 ? 'åŒ…é‚®' : `Â¥${shippingFee}`}</span>
        </div>
        <div className="item discount">
          <span>ä¼˜æƒ </span>
          <span>-Â¥{discountAmount}</span>
        </div>
        <div className="item total">
          <span>å®ä»˜æ¬¾</span>
          <span className="price">Â¥{totalAmount}</span>
        </div>
      </div>
      
      {/* æäº¤è®¢å• */}
      <Button
        type="primary"
        size="large"
        onClick={handleSubmit}
        loading={submitting}
      >
        æäº¤è®¢å•
      </Button>
    </div>
  );
}
```

---

## æ™ºèƒ½åˆçº¦è®¾è®¡

### åˆçº¦æ¶æ„

```
LycheeNFTç”Ÿæ€åˆçº¦
â”œâ”€â”€ LycheeNFT.sol            # NFTåˆçº¦ï¼ˆERC-721ï¼‰
â”œâ”€â”€ PresaleManager.sol       # é¢„å”®ç®¡ç†åˆçº¦
â”œâ”€â”€ EscrowManager.sol        # èµ„é‡‘æ‰˜ç®¡åˆçº¦
â”œâ”€â”€ GovernanceToken.sol      # æ²»ç†ä»£å¸åˆçº¦
â””â”€â”€ Marketplace.sol          # äºŒçº§å¸‚åœºåˆçº¦
```

### æ ¸å¿ƒåˆçº¦ä»£ç 

#### é¢„å”®ç®¡ç†åˆçº¦

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/security/Pausable.sol";

contract PresaleManager is Ownable, ReentrancyGuard, Pausable {
    
    struct Presale {
        bytes32 presaleId;
        address orchard;
        uint256 price;
        uint256 totalSupply;
        uint256 soldCount;
        uint256 startTime;
        uint256 endTime;
        bool active;
        mapping(address => uint256) purchases;
    }
    
    mapping(bytes32 => Presale) public presales;
    address public escrowManager;
    address public nftContract;
    
    event PresaleCreated(
        bytes32 indexed presaleId,
        address orchard,
        uint256 price,
        uint256 totalSupply
    );
    
    event Purchase(
        bytes32 indexed presaleId,
        address buyer,
        uint256 quantity,
        uint256 amount
    );
    
    constructor(
        address _escrowManager,
        address _nftContract
    ) {
        escrowManager = _escrowManager;
        nftContract = _nftContract;
    }
    
    // åˆ›å»ºé¢„å”®æ´»åŠ¨
    function createPresale(
        bytes32 presaleId,
        address orchard,
        uint256 price,
        uint256 totalSupply,
        uint256 startTime,
        uint256 endTime
    ) external onlyOwner {
        require(presales[presaleId].presaleId == bytes32(0), "Presale exists");
        require(totalSupply > 0, "Invalid supply");
        require(endTime > startTime, "Invalid time");
        
        Presale storage presale = presales[presaleId];
        presale.presaleId = presaleId;
        presale.orchard = orchard;
        presale.price = price;
        presale.totalSupply = totalSupply;
        presale.startTime = startTime;
        presale.endTime = endTime;
        presale.active = true;
        
        emit PresaleCreated(presaleId, orchard, price, totalSupply);
    }
    
    // è´­ä¹°NFT
    function purchase(
        bytes32 presaleId,
        uint256 quantity
    ) external payable nonReentrant whenNotPaused {
        Presale storage presale = presales[presaleId];
        
        require(presale.active, "Presale inactive");
        require(block.timestamp >= presale.startTime, "Not started");
        require(block.timestamp <= presale.endTime, "Ended");
        require(quantity > 0, "Invalid quantity");
        require(
            presale.soldCount + quantity <= presale.totalSupply,
            "Sold out"
        );
        
        uint256 totalPrice = presale.price * quantity;
        require(msg.value >= totalPrice, "Insufficient payment");
        
        // æ›´æ–°é”€å”®æ•°é‡
        presale.soldCount += quantity;
        presale.purchases[msg.sender] += quantity;
        
        // è½¬å…¥æ‰˜ç®¡åˆçº¦
        (bool success, ) = escrowManager.call{value: msg.value}(
            abi.encodeWithSignature(
                "createEscrow(bytes32,address,address,uint256)",
                presaleId,
                msg.sender,
                presale.orchard,
                msg.value
            )
        );
        require(success, "Escrow failed");
        
        emit Purchase(presaleId, msg.sender, quantity, msg.value);
        
        // é€€è¿˜å¤šä½™é‡‘é¢
        if (msg.value > totalPrice) {
            payable(msg.sender).transfer(msg.value - totalPrice);
        }
    }
    
    // æŸ¥è¯¢é¢„å”®ä¿¡æ¯
    function getPresale(bytes32 presaleId) 
        external 
        view 
        returns (
            address orchard,
            uint256 price,
            uint256 totalSupply,
            uint256 soldCount,
            uint256 startTime,
            uint256 endTime,
            bool active
        ) 
    {
        Presale storage presale = presales[presaleId];
        return (
            presale.orchard,
            presale.price,
            presale.totalSupply,
            presale.soldCount,
            presale.startTime,
            presale.endTime,
            presale.active
        );
    }
    
    // æŸ¥è¯¢ç”¨æˆ·è´­ä¹°æ•°é‡
    function getUserPurchases(
        bytes32 presaleId,
        address user
    ) external view returns (uint256) {
        return presales[presaleId].purchases[user];
    }
}
```

---

## ä¸šåŠ¡æµç¨‹

### å®Œæ•´é¢„å”®æµç¨‹æ—¶åºå›¾

```
ç”¨æˆ·          å‰ç«¯          åç«¯          åˆçº¦          æœå›­
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚â”€æµè§ˆé¢„å”®â”€â”€â”€â†’â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚â”€è·å–åˆ—è¡¨â”€â”€â”€â†’â”‚             â”‚             â”‚
 â”‚             â”‚â†è¿”å›æ•°æ®â”€â”€â”€â”€â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚â”€ä¸‹å•è´­ä¹°â”€â”€â”€â†’â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚â”€åˆ›å»ºè®¢å•â”€â”€â”€â†’â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚â”€é”å®šåº“å­˜â”€â”€â”€â†’â”‚             â”‚
 â”‚             â”‚             â”‚â†è¿”å›è®¢å•â”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚â†è¿”å›æ”¯ä»˜ä¿¡æ¯â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚â”€å®Œæˆæ”¯ä»˜â”€â”€â”€â†’â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚â”€æ”¯ä»˜å›è°ƒâ”€â”€â”€â†’â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚â”€åˆ›å»ºæ‰˜ç®¡â”€â”€â”€â†’â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚â”€æ‰£é™¤å¹³å°è´¹â”€â†’â”‚
 â”‚             â”‚             â”‚             â”‚â”€é”å®šå‰©ä½™æ¬¾â”€â†’â”‚
 â”‚             â”‚             â”‚â†è¿”å›ç»“æœâ”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚             â”‚â”€é“¸é€ NFTâ”€â”€â”€â”€â†’â”‚             â”‚
 â”‚             â”‚             â”‚â†NFTä¿¡æ¯â”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚â†æ”¯ä»˜æˆåŠŸâ”€â”€â”€â”€â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚      â”Œâ”€â”€â”€ç”Ÿäº§æœŸâ”€â”€â”€â”
 â”‚             â”‚             â”‚             â”‚      â”‚  ç§æ¤å…»æŠ¤   â”‚
 â”‚â”€æŸ¥çœ‹æº¯æºâ”€â”€â”€â†’â”‚             â”‚             â”‚      â”‚  æ•°æ®ä¸Šä¼    â”‚
 â”‚             â”‚â”€è·å–æº¯æºâ”€â”€â”€â†’â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚             â”‚             â”‚â†æº¯æºæ•°æ®â”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚â†å±•ç¤ºæº¯æºâ”€â”€â”€â”€â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚      â”Œâ”€â”€â”€é‡‡æ‘˜æœŸâ”€â”€â”€â”
 â”‚             â”‚             â”‚             â”‚      â”‚  é‡‡æ‘˜æ‰“åŒ…   â”‚
 â”‚             â”‚             â”‚             â”‚      â”‚  ç¡®è®¤å‘è´§   â”‚
 â”‚             â”‚             â”‚â†å‘è´§é€šçŸ¥â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚             â”‚             â”‚â”€é‡Šæ”¾é¦–æ¬¾â”€â”€â”€â†’â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚â”€æ”¯ä»˜é¦–æ¬¾â”€â”€â”€â†’â”‚
 â”‚             â”‚             â”‚             â”‚â”€æ”¯ä»˜ç‰©æµè´¹â”€â†’â”‚
 â”‚             â”‚â†å‘è´§é€šçŸ¥â”€â”€â”€â”€â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚â”€æ”¶åˆ°è´§ç‰©â”€â”€â”€â†’â”‚             â”‚             â”‚             â”‚
 â”‚â”€ç¡®è®¤æ”¶è´§â”€â”€â”€â†’â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚â”€ç¡®è®¤æ”¶è´§â”€â”€â”€â†’â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚â”€é‡Šæ”¾å°¾æ¬¾â”€â”€â”€â†’â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚â”€æ”¯ä»˜å°¾æ¬¾â”€â”€â”€â†’â”‚
 â”‚             â”‚             â”‚â†å®Œæˆäº¤æ˜“â”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚â†äº¤æ˜“å®Œæˆâ”€â”€â”€â”€â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚             â”‚             â”‚
 â”‚â”€è¯„ä»·æ™’å•â”€â”€â”€â†’â”‚             â”‚             â”‚             â”‚
 â”‚             â”‚â”€æäº¤è¯„ä»·â”€â”€â”€â†’â”‚             â”‚             â”‚
 â”‚             â”‚             â”‚â”€æ›´æ–°ä¿¡ç”¨â”€â”€â”€â†’â”‚             â”‚
 â”‚             â”‚â†è¯„ä»·æˆåŠŸâ”€â”€â”€â”€â”‚             â”‚             â”‚
```

---

## éƒ¨ç½²æ–¹æ¡ˆ

### Dockeréƒ¨ç½²

æ‰€æœ‰æœåŠ¡éƒ½å·²é…ç½®åœ¨Docker Composeä¸­ï¼š

```yaml
# é¢„å”®æœåŠ¡å·²åŒ…å«åœ¨ docker-compose.yml ä¸­
# å¯ç›´æ¥ä½¿ç”¨ï¼š
cd deployment/docker
make prod
```

### Kuberneteséƒ¨ç½²

```yaml
# k8s/presale-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: presale-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: presale-service
  template:
    metadata:
      labels:
        app: presale-service
    spec:
      containers:
      - name: presale-service
        image: lychee-nft/presale-service:latest
        ports:
        - containerPort: 4001
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: redis-secret
              key: url
```

---

## æ€»ç»“

è¿™å¥—é¢„å”®ç³»ç»ŸåŒ…å«ï¼š

âœ… **å®Œæ•´çš„åŠŸèƒ½æ¨¡å—**
- é¢„å”®ç®¡ç†
- è®¢å•ç®¡ç†
- æ”¯ä»˜æ‰˜ç®¡
- NFTé“¸é€ 
- æº¯æºè¿½è¸ª
- ç‰©æµé…é€

âœ… **å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆ**
- å¾®æœåŠ¡æ¶æ„è®¾è®¡
- æ•°æ®åº“è¡¨ç»“æ„
- RESTful APIæ¥å£
- æ™ºèƒ½åˆçº¦ä»£ç 
- å‰ç«¯é¡µé¢åŸå‹

âœ… **å®Œæ•´çš„ä¸šåŠ¡æµç¨‹**
- ä»åˆ›å»ºé¢„å”®åˆ°ç¡®è®¤æ”¶è´§
- èµ„é‡‘åˆ†æ®µé‡Šæ”¾æœºåˆ¶
- äº‰è®®å¤„ç†æµç¨‹
- ä¿¡ç”¨è¯„åˆ†ä½“ç³»

âœ… **å®Œæ•´çš„éƒ¨ç½²æ–¹æ¡ˆ**
- Dockerå®¹å™¨åŒ–
- Kubernetesç¼–æ’
- ç›‘æ§å‘Šè­¦
- å¤‡ä»½æ¢å¤

**å¯ç›´æ¥ç”¨äºå¼€å‘å®æ–½ï¼**

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-05  
**ä½œè€…**: Lychee NFT Platform Team
